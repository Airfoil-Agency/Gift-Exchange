<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Family Gift Exchange</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ</text></svg>">
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;

    // ============================================================
    // FIREBASE CONFIGURATION - YOU MUST REPLACE THESE VALUES
    // ============================================================
    // Follow the setup instructions below to get your own config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    // ============================================================

    // Initialize Firebase
    let db = null;
    let firebaseInitialized = false;
    
    try {
      if (firebaseConfig.apiKey !== "YOUR_API_KEY") {
        firebase.initializeApp(firebaseConfig);
        db = firebase.database();
        firebaseInitialized = true;
      }
    } catch (error) {
      console.error("Firebase initialization error:", error);
    }

    // Generate a random session ID
    const generateSessionId = () => {
      return Math.random().toString(36).substring(2, 8).toUpperCase();
    };

    // Generate a simple member token
    const generateMemberToken = () => {
      return Math.random().toString(36).substring(2, 10);
    };

    // Setup Instructions Component
    function SetupInstructions() {
      return (
        <div className="min-h-screen bg-gradient-to-br from-red-50 via-white to-green-50 p-6">
          <div className="max-w-2xl mx-auto">
            <div className="text-center mb-8">
              <div className="text-6xl mb-4">âš™ï¸</div>
              <h1 className="text-3xl font-bold text-gray-800 mb-2">Setup Required</h1>
              <p className="text-gray-600">One-time Firebase configuration needed</p>
            </div>

            <div className="bg-white rounded-xl shadow-lg p-6 space-y-6">
              <div className="bg-amber-50 border border-amber-200 rounded-lg p-4">
                <p className="text-amber-800 font-medium">
                  âš ï¸ Firebase is not configured yet. Follow these steps to set it up (takes about 5 minutes):
                </p>
              </div>

              <div className="space-y-4">
                <div className="border-l-4 border-red-400 pl-4">
                  <h3 className="font-bold text-gray-800">Step 1: Create a Firebase Project</h3>
                  <ol className="text-sm text-gray-600 mt-2 space-y-1 list-decimal list-inside">
                    <li>Go to <a href="https://console.firebase.google.com/" target="_blank" className="text-blue-600 underline">console.firebase.google.com</a></li>
                    <li>Click "Create a project" (or "Add project")</li>
                    <li>Name it something like "gift-exchange"</li>
                    <li>Disable Google Analytics (not needed) and click Create</li>
                  </ol>
                </div>

                <div className="border-l-4 border-orange-400 pl-4">
                  <h3 className="font-bold text-gray-800">Step 2: Create a Realtime Database</h3>
                  <ol className="text-sm text-gray-600 mt-2 space-y-1 list-decimal list-inside">
                    <li>In Firebase Console, click "Build" â†’ "Realtime Database"</li>
                    <li>Click "Create Database"</li>
                    <li>Choose your region (any is fine)</li>
                    <li>Select "Start in <strong>test mode</strong>" and click Enable</li>
                  </ol>
                </div>

                <div className="border-l-4 border-yellow-400 pl-4">
                  <h3 className="font-bold text-gray-800">Step 3: Get Your Config</h3>
                  <ol className="text-sm text-gray-600 mt-2 space-y-1 list-decimal list-inside">
                    <li>Click the gear icon âš™ï¸ â†’ "Project settings"</li>
                    <li>Scroll down to "Your apps" and click the web icon {"</>"}</li>
                    <li>Name it "gift-exchange" and click "Register app"</li>
                    <li>Copy the firebaseConfig object shown</li>
                  </ol>
                </div>

                <div className="border-l-4 border-green-400 pl-4">
                  <h3 className="font-bold text-gray-800">Step 4: Update This File</h3>
                  <ol className="text-sm text-gray-600 mt-2 space-y-1 list-decimal list-inside">
                    <li>Open index.html in a text editor</li>
                    <li>Find the <code className="bg-gray-100 px-1 rounded">firebaseConfig</code> section near the top</li>
                    <li>Replace the placeholder values with your actual config</li>
                    <li>Save and re-upload to GitHub</li>
                  </ol>
                </div>

                <div className="bg-gray-50 rounded-lg p-4">
                  <h4 className="font-mono text-sm font-bold text-gray-700 mb-2">Your config will look like this:</h4>
                  <pre className="text-xs bg-gray-800 text-green-400 p-3 rounded overflow-x-auto">
{`const firebaseConfig = {
  apiKey: "AIzaSyB...",
  authDomain: "gift-exchange-xxxxx.firebaseapp.com",
  databaseURL: "https://gift-exchange-xxxxx-default-rtdb.firebaseio.com",
  projectId: "gift-exchange-xxxxx",
  storageBucket: "gift-exchange-xxxxx.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123456789:web:abc123..."
};`}
                  </pre>
                </div>
              </div>

              <div className="text-center pt-4">
                <button
                  onClick={() => window.location.reload()}
                  className="bg-gradient-to-r from-red-500 to-green-500 text-white px-6 py-3 rounded-xl font-bold hover:from-red-600 hover:to-green-600"
                >
                  ğŸ”„ I've Updated the Config - Reload
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Admin View Component
    function AdminView({ sessionId, onBack }) {
      const [members, setMembers] = useState([]);
      const [newMemberName, setNewMemberName] = useState('');
      const [sessionData, setSessionData] = useState(null);
      const [assignments, setAssignments] = useState(null);
      const [copiedLink, setCopiedLink] = useState(null);
      const [adminNumber, setAdminNumber] = useState('');
      const [adminName, setAdminName] = useState('');
      const [isSettingUp, setIsSettingUp] = useState(true);

      const baseUrl = window.location.origin + window.location.pathname;

      useEffect(() => {
        if (!sessionId || !db) return;

        const sessionRef = db.ref(`sessions/${sessionId}`);
        sessionRef.on('value', (snapshot) => {
          const data = snapshot.val();
          setSessionData(data);
          if (data?.members) {
            setMembers(Object.values(data.members));
          }
          if (data?.assignments) {
            setAssignments(data.assignments);
          }
          if (data?.setupComplete) {
            setIsSettingUp(false);
          }
        });

        return () => sessionRef.off();
      }, [sessionId]);

      const addMember = () => {
        if (!newMemberName.trim()) return;
        
        const memberToken = generateMemberToken();
        const memberData = {
          name: newMemberName.trim(),
          token: memberToken,
          hasEntered: false,
          number: null,
          isAdmin: false
        };

        db.ref(`sessions/${sessionId}/members/${memberToken}`).set(memberData);
        setNewMemberName('');
      };

      const addAdminAsMember = () => {
        if (!adminName.trim()) return;
        
        const memberToken = generateMemberToken();
        const memberData = {
          name: adminName.trim(),
          token: memberToken,
          hasEntered: false,
          number: null,
          isAdmin: true
        };

        db.ref(`sessions/${sessionId}/members/${memberToken}`).set(memberData);
        db.ref(`sessions/${sessionId}/adminToken`).set(memberToken);
        setAdminName('');
      };

      const removeMember = (token) => {
        db.ref(`sessions/${sessionId}/members/${token}`).remove();
      };

      const completeSetup = () => {
        db.ref(`sessions/${sessionId}/setupComplete`).set(true);
        setIsSettingUp(false);
      };

      const submitAdminNumber = () => {
        const adminMember = members.find(m => m.isAdmin);
        if (!adminMember || !adminNumber) return;
        
        const num = parseInt(adminNumber);
        if (num < 1 || num > 40) return;

        db.ref(`sessions/${sessionId}/members/${adminMember.token}`).update({
          number: num,
          hasEntered: true
        });
        setAdminNumber('');
      };

      const copyLink = (member) => {
        const link = `${baseUrl}?session=${sessionId}&token=${member.token}`;
        navigator.clipboard.writeText(link);
        setCopiedLink(member.token);
        setTimeout(() => setCopiedLink(null), 2000);
      };

      const allEntered = members.length >= 2 && members.every(m => m.hasEntered);

      const calculateAssignments = () => {
        const parsed = members.map(m => ({
          name: m.name,
          number: m.number,
          token: m.token
        }));

        const results = parsed.map(person => {
          const others = parsed.filter(p => p.token !== person.token);
          
          const closest = others.reduce((prev, curr) =>
            Math.abs(curr.number - person.number) < Math.abs(prev.number - person.number)
              ? curr
              : prev
          );

          const furthest = others.reduce((prev, curr) =>
            Math.abs(curr.number - person.number) > Math.abs(prev.number - person.number)
              ? curr
              : prev
          );

          return {
            person: person.name,
            number: person.number,
            receivesFrom: closest.name,
            receivesFromNumber: closest.number,
            givesTo: furthest.name,
            givesToNumber: furthest.number,
            idealMatch: closest.name !== furthest.name,
          };
        });

        db.ref(`sessions/${sessionId}/assignments`).set(results);
        db.ref(`sessions/${sessionId}/revealed`).set(true);
      };

      const resetSession = () => {
        members.forEach(m => {
          db.ref(`sessions/${sessionId}/members/${m.token}`).update({
            hasEntered: false,
            number: null
          });
        });
        db.ref(`sessions/${sessionId}/assignments`).remove();
        db.ref(`sessions/${sessionId}/revealed`).remove();
        setAssignments(null);
      };

      const adminMember = members.find(m => m.isAdmin);
      const otherMembers = members.filter(m => !m.isAdmin);

      if (isSettingUp) {
        return (
          <div className="space-y-6">
            <div className="bg-white rounded-xl shadow-lg p-6">
              <h2 className="text-xl font-bold text-gray-800 mb-4">ğŸ‘¥ Setup Family Members</h2>
              
              {/* Admin setup */}
              <div className="mb-6 p-4 bg-amber-50 rounded-lg border border-amber-200">
                <h3 className="font-semibold text-amber-800 mb-2">First, add yourself:</h3>
                {!adminMember ? (
                  <div className="flex gap-2">
                    <input
                      type="text"
                      placeholder="Your name"
                      value={adminName}
                      onChange={(e) => setAdminName(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && addAdminAsMember()}
                      className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400"
                    />
                    <button
                      onClick={addAdminAsMember}
                      className="bg-amber-500 text-white px-4 py-2 rounded-lg hover:bg-amber-600 font-medium"
                    >
                      Add Me
                    </button>
                  </div>
                ) : (
                  <div className="flex items-center gap-2 text-amber-700">
                    <span className="text-xl">âœ…</span>
                    <span className="font-medium">{adminMember.name}</span>
                    <span className="text-sm">(you - admin)</span>
                  </div>
                )}
              </div>

              {/* Other members */}
              <div className="mb-4">
                <h3 className="font-semibold text-gray-700 mb-2">Add other family members:</h3>
                <div className="flex gap-2">
                  <input
                    type="text"
                    placeholder="Family member name"
                    value={newMemberName}
                    onChange={(e) => setNewMemberName(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && addMember()}
                    className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400"
                  />
                  <button
                    onClick={addMember}
                    className="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 font-medium"
                  >
                    + Add
                  </button>
                </div>
              </div>

              {/* Members list */}
              {otherMembers.length > 0 && (
                <div className="space-y-2 mb-4">
                  {otherMembers.map((member) => (
                    <div key={member.token} className="flex items-center justify-between bg-gray-50 p-3 rounded-lg">
                      <span className="font-medium">{member.name}</span>
                      <button
                        onClick={() => removeMember(member.token)}
                        className="text-red-500 hover:text-red-700 text-sm"
                      >
                        âœ• Remove
                      </button>
                    </div>
                  ))}
                </div>
              )}

              {members.length >= 2 && (
                <button
                  onClick={completeSetup}
                  className="w-full py-3 bg-gradient-to-r from-red-500 to-green-500 text-white rounded-xl font-bold hover:from-red-600 hover:to-green-600"
                >
                  âœ“ Done Adding Members - Continue
                </button>
              )}

              {members.length < 2 && (
                <p className="text-sm text-gray-500 text-center mt-4">
                  Add at least 2 members to continue
                </p>
              )}
            </div>
          </div>
        );
      }

      if (assignments) {
        return (
          <div className="space-y-4">
            <div className="bg-green-100 border border-green-300 rounded-xl p-4 text-center">
              <span className="text-2xl">ğŸ‰</span>
              <h2 className="text-xl font-bold text-green-800">Assignments Ready!</h2>
            </div>

            {assignments.map((assignment, index) => (
              <div key={index} className="bg-white rounded-xl shadow-lg p-5 border-2 border-green-200">
                <div className="flex items-center justify-between mb-4">
                  <div className="flex items-center gap-3">
                    <span className="text-3xl">ğŸ…</span>
                    <div>
                      <h3 className="text-xl font-bold text-gray-800">{assignment.person}</h3>
                      <span className="text-sm text-gray-500">Number: {assignment.number}</span>
                    </div>
                  </div>
                  {assignment.idealMatch && (
                    <span className="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-medium">
                      âœ“ Ideal
                    </span>
                  )}
                </div>

                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div className="bg-red-50 rounded-lg p-3 border border-red-200">
                    <div className="text-sm text-red-600 font-medium mb-1">ğŸ Gives to:</div>
                    <div className="text-lg font-bold text-red-700">{assignment.givesTo}</div>
                  </div>
                  <div className="bg-green-50 rounded-lg p-3 border border-green-200">
                    <div className="text-sm text-green-600 font-medium mb-1">ğŸ€ Receives from:</div>
                    <div className="text-lg font-bold text-green-700">{assignment.receivesFrom}</div>
                  </div>
                </div>
              </div>
            ))}

            <button
              onClick={resetSession}
              className="w-full py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-bold border border-gray-300"
            >
              ğŸ”„ Start Over
            </button>
          </div>
        );
      }

      return (
        <div className="space-y-6">
          {/* Session Info */}
          <div className="bg-white rounded-xl shadow-lg p-6">
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-xl font-bold text-gray-800">ğŸ“‹ Session: {sessionId}</h2>
              <span className="text-sm text-gray-500">
                {members.filter(m => m.hasEntered).length} / {members.length} entered
              </span>
            </div>

            {/* Admin's number entry */}
            {adminMember && !adminMember.hasEntered && (
              <div className="mb-6 p-4 bg-amber-50 rounded-lg border border-amber-200">
                <h3 className="font-semibold text-amber-800 mb-2">Enter your secret number:</h3>
                <div className="flex gap-2">
                  <input
                    type="number"
                    min="1"
                    max="40"
                    placeholder="1-40"
                    value={adminNumber}
                    onChange={(e) => setAdminNumber(e.target.value)}
                    className="w-24 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400"
                  />
                  <button
                    onClick={submitAdminNumber}
                    className="bg-amber-500 text-white px-4 py-2 rounded-lg hover:bg-amber-600 font-medium"
                  >
                    Submit
                  </button>
                </div>
              </div>
            )}

            {adminMember && adminMember.hasEntered && (
              <div className="mb-6 p-4 bg-green-50 rounded-lg border border-green-200">
                <div className="flex items-center gap-2 text-green-700">
                  <span className="text-xl">âœ…</span>
                  <span className="font-medium">Your number is submitted!</span>
                </div>
              </div>
            )}

            {/* Share links */}
            <h3 className="font-semibold text-gray-700 mb-3">ğŸ“¤ Share these links with family:</h3>
            <div className="space-y-3">
              {otherMembers.map((member) => (
                <div
                  key={member.token}
                  className={`flex items-center justify-between p-3 rounded-lg border ${
                    member.hasEntered 
                      ? 'bg-green-50 border-green-200' 
                      : 'bg-gray-50 border-gray-200'
                  }`}
                >
                  <div className="flex items-center gap-3">
                    <span className="text-xl">{member.hasEntered ? 'âœ…' : 'â³'}</span>
                    <div>
                      <span className="font-medium">{member.name}</span>
                      <span className="text-sm text-gray-500 ml-2">
                        {member.hasEntered ? 'Entered!' : 'Waiting...'}
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={() => copyLink(member)}
                    className={`px-3 py-1 rounded-lg text-sm font-medium transition-all ${
                      copiedLink === member.token
                        ? 'bg-green-500 text-white'
                        : 'bg-blue-100 text-blue-700 hover:bg-blue-200'
                    }`}
                  >
                    {copiedLink === member.token ? 'âœ“ Copied!' : 'ğŸ“‹ Copy Link'}
                  </button>
                </div>
              ))}
            </div>
          </div>

          {/* Generate button */}
          <button
            onClick={calculateAssignments}
            disabled={!allEntered}
            className={`w-full py-4 rounded-xl font-bold text-lg transition-all ${
              allEntered
                ? 'bg-gradient-to-r from-red-500 to-green-500 text-white hover:from-red-600 hover:to-green-600 shadow-lg'
                : 'bg-gray-300 text-gray-500 cursor-not-allowed'
            }`}
          >
            {allEntered ? 'ğŸ„ Generate Gift Assignments ğŸ„' : `â³ Waiting for ${members.filter(m => !m.hasEntered).length} more...`}
          </button>
        </div>
      );
    }

    // Member Entry View
    function MemberView({ sessionId, token }) {
      const [memberData, setMemberData] = useState(null);
      const [number, setNumber] = useState('');
      const [sessionData, setSessionData] = useState(null);
      const [submitted, setSubmitted] = useState(false);

      useEffect(() => {
        if (!sessionId || !token || !db) return;

        const memberRef = db.ref(`sessions/${sessionId}/members/${token}`);
        memberRef.on('value', (snapshot) => {
          const data = snapshot.val();
          setMemberData(data);
          if (data?.hasEntered) {
            setSubmitted(true);
          }
        });

        const sessionRef = db.ref(`sessions/${sessionId}`);
        sessionRef.on('value', (snapshot) => {
          setSessionData(snapshot.val());
        });

        return () => {
          memberRef.off();
          sessionRef.off();
        };
      }, [sessionId, token]);

      const submitNumber = () => {
        const num = parseInt(number);
        if (num < 1 || num > 40) return;

        db.ref(`sessions/${sessionId}/members/${token}`).update({
          number: num,
          hasEntered: true
        });
        setSubmitted(true);
      };

      if (!memberData) {
        return (
          <div className="text-center py-12">
            <div className="text-4xl mb-4">ğŸ”</div>
            <p className="text-gray-600">Loading...</p>
          </div>
        );
      }

      // Show personal assignment if revealed
      if (sessionData?.revealed && sessionData?.assignments) {
        const myAssignment = sessionData.assignments.find(a => a.person === memberData.name);
        
        return (
          <div className="space-y-6">
            <div className="bg-green-100 border border-green-300 rounded-xl p-4 text-center">
              <span className="text-4xl">ğŸ‰</span>
              <h2 className="text-2xl font-bold text-green-800 mt-2">Your Assignment!</h2>
            </div>

            {myAssignment && (
              <div className="bg-white rounded-xl shadow-lg p-6">
                <div className="text-center mb-6">
                  <span className="text-5xl">ğŸ…</span>
                  <h3 className="text-2xl font-bold text-gray-800 mt-2">{myAssignment.person}</h3>
                </div>

                <div className="space-y-4">
                  <div className="bg-red-50 rounded-lg p-4 border-2 border-red-200 text-center">
                    <div className="text-sm text-red-600 font-medium mb-1">ğŸ You're giving a gift to:</div>
                    <div className="text-2xl font-bold text-red-700">{myAssignment.givesTo}</div>
                  </div>

                  <div className="bg-green-50 rounded-lg p-4 border-2 border-green-200 text-center">
                    <div className="text-sm text-green-600 font-medium mb-1">ğŸ€ You're receiving a gift from:</div>
                    <div className="text-2xl font-bold text-green-700">{myAssignment.receivesFrom}</div>
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      }

      if (submitted || memberData.hasEntered) {
        const totalMembers = sessionData?.members ? Object.keys(sessionData.members).length : 0;
        const enteredCount = sessionData?.members 
          ? Object.values(sessionData.members).filter(m => m.hasEntered).length 
          : 0;

        return (
          <div className="space-y-6">
            <div className="bg-green-100 border border-green-300 rounded-xl p-6 text-center">
              <span className="text-5xl">âœ…</span>
              <h2 className="text-2xl font-bold text-green-800 mt-4">You're all set, {memberData.name}!</h2>
              <p className="text-green-600 mt-2">Your secret number has been submitted.</p>
            </div>

            <div className="bg-white rounded-xl shadow-lg p-6 text-center">
              <div className="text-4xl mb-4">â³</div>
              <h3 className="text-lg font-semibold text-gray-700">Waiting for others...</h3>
              <p className="text-gray-500 mt-2">
                {enteredCount} of {totalMembers} family members have entered
              </p>
              <div className="w-full bg-gray-200 rounded-full h-3 mt-4">
                <div 
                  className="bg-gradient-to-r from-red-500 to-green-500 h-3 rounded-full transition-all"
                  style={{ width: `${(enteredCount / totalMembers) * 100}%` }}
                ></div>
              </div>
              <p className="text-sm text-gray-400 mt-4">
                This page will update automatically when assignments are ready!
              </p>
            </div>
          </div>
        );
      }

      return (
        <div className="space-y-6">
          <div className="bg-white rounded-xl shadow-lg p-6 text-center">
            <span className="text-5xl">ğŸ‘‹</span>
            <h2 className="text-2xl font-bold text-gray-800 mt-4">
              Welcome, {memberData.name}!
            </h2>
            <p className="text-gray-600 mt-2">
              Enter your secret number below to join the gift exchange.
            </p>
          </div>

          <div className="bg-white rounded-xl shadow-lg p-6">
            <label className="block text-lg font-semibold text-gray-700 mb-3">
              Pick a number between 1 and 40:
            </label>
            <input
              type="number"
              min="1"
              max="40"
              value={number}
              onChange={(e) => setNumber(e.target.value)}
              placeholder="Enter your number"
              className="w-full px-4 py-3 text-xl text-center border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent"
            />
            
            <button
              onClick={submitNumber}
              disabled={!number || parseInt(number) < 1 || parseInt(number) > 40}
              className={`w-full mt-4 py-4 rounded-xl font-bold text-lg transition-all ${
                number && parseInt(number) >= 1 && parseInt(number) <= 40
                  ? 'bg-gradient-to-r from-red-500 to-green-500 text-white hover:from-red-600 hover:to-green-600 shadow-lg'
                  : 'bg-gray-300 text-gray-500 cursor-not-allowed'
              }`}
            >
              ğŸ Submit My Number
            </button>
          </div>

          <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
            <p className="text-sm text-amber-700 text-center">
              ğŸ¤« Your number is secret! No one else will see what you picked.
            </p>
          </div>
        </div>
      );
    }

    // Main App Component
    function GiftGiverApp() {
      const [view, setView] = useState('home');
      const [sessionId, setSessionId] = useState('');
      const [memberToken, setMemberToken] = useState('');

      useEffect(() => {
        // Check URL parameters
        const params = new URLSearchParams(window.location.search);
        const urlSession = params.get('session');
        const urlToken = params.get('token');

        if (urlSession && urlToken) {
          setSessionId(urlSession);
          setMemberToken(urlToken);
          setView('member');
        } else if (urlSession) {
          setSessionId(urlSession);
          setView('admin');
        }
      }, []);

      const createNewSession = () => {
        const newId = generateSessionId();
        db.ref(`sessions/${newId}`).set({
          created: Date.now(),
          members: {},
          setupComplete: false
        });
        setSessionId(newId);
        setView('admin');
        
        // Update URL
        window.history.pushState({}, '', `?session=${newId}`);
      };

      const goHome = () => {
        setView('home');
        setSessionId('');
        setMemberToken('');
        window.history.pushState({}, '', window.location.pathname);
      };

      // Show setup instructions if Firebase not configured
      if (!firebaseInitialized) {
        return <SetupInstructions />;
      }

      return (
        <div className="min-h-screen bg-gradient-to-br from-red-50 via-white to-green-50 p-6">
          <div className="max-w-2xl mx-auto">
            {/* Header */}
            <div className="text-center mb-8">
              <div className="text-6xl mb-4">ğŸ</div>
              <h1 className="text-3xl font-bold text-gray-800 mb-2">
                Family Gift Exchange
              </h1>
              {view !== 'home' && (
                <button 
                  onClick={goHome}
                  className="text-sm text-gray-500 hover:text-gray-700 underline"
                >
                  â† Back to Home
                </button>
              )}
            </div>

            {/* Views */}
            {view === 'home' && (
              <div className="space-y-4">
                <div className="bg-white rounded-xl shadow-lg p-6 text-center">
                  <h2 className="text-xl font-bold text-gray-800 mb-4">Start a New Gift Exchange</h2>
                  <p className="text-gray-600 mb-6">
                    Create a session, add family members, and share individual links for private number entry.
                  </p>
                  <button
                    onClick={createNewSession}
                    className="w-full py-4 bg-gradient-to-r from-red-500 to-green-500 text-white rounded-xl font-bold text-lg hover:from-red-600 hover:to-green-600 shadow-lg"
                  >
                    ğŸ„ Create New Exchange ğŸ„
                  </button>
                </div>

                <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                  <h3 className="font-semibold text-amber-800 mb-2">ğŸ“‹ How it works:</h3>
                  <ol className="text-sm text-amber-700 space-y-1 list-decimal list-inside">
                    <li>Create a new exchange session</li>
                    <li>Add yourself and family members</li>
                    <li>Share unique links with each person</li>
                    <li>Everyone enters their secret number (1-40)</li>
                    <li>Generate assignments when everyone's ready!</li>
                  </ol>
                </div>
              </div>
            )}

            {view === 'admin' && (
              <AdminView sessionId={sessionId} onBack={goHome} />
            )}

            {view === 'member' && (
              <MemberView sessionId={sessionId} token={memberToken} />
            )}

            {/* Footer */}
            <div className="text-center mt-8 text-gray-400 text-sm">
              Happy Holidays! ğŸ„â„ï¸ğŸ
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<GiftGiverApp />);
  </script>
</body>
</html>
