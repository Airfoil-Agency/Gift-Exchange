<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Family Gift Exchange</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ</text></svg>">
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState } = React;

    function GiftGiverApp() {
      const [step, setStep] = useState('count'); // count | admin | members | duplicates | results
      const [totalPeople, setTotalPeople] = useState('');
      const [adminName, setAdminName] = useState('');
      const [adminNumber, setAdminNumber] = useState('');
      const [participants, setParticipants] = useState([]);
      const [currentName, setCurrentName] = useState('');
      const [currentNumber, setCurrentNumber] = useState('');
      const [duplicateError, setDuplicateError] = useState(null);
      const [assignments, setAssignments] = useState(null);

      const totalMembers = parseInt(totalPeople) || 0;

      // Step 1: Set number of people
      const proceedToAdmin = () => {
        const num = parseInt(totalPeople);
        if (num >= 3 && num <= 20) {
          setStep('admin');
        }
      };

      // Step 2: Admin enters their info
      const proceedToMembers = () => {
        if (adminName.trim() && adminNumber) {
          const num = parseInt(adminNumber);
          if (num >= 1 && num <= 100) {
            setParticipants([{ name: adminName.trim(), number: num }]);
            setStep('members');
          }
        }
      };

      // Step 3: Add each member
      const addMember = () => {
        if (currentName.trim() && currentNumber) {
          const num = parseInt(currentNumber);
          if (num >= 1 && num <= 100) {
            const newParticipants = [...participants, { name: currentName.trim(), number: num }];
            setParticipants(newParticipants);
            setCurrentName('');
            setCurrentNumber('');
            
            if (newParticipants.length >= totalMembers) {
              checkDuplicatesAndGenerate(newParticipants);
            }
          }
        }
      };

      // Check for duplicate numbers
      const checkDuplicatesAndGenerate = (allParticipants) => {
        const numberMap = {};
        const duplicates = [];

        allParticipants.forEach(p => {
          if (numberMap[p.number]) {
            numberMap[p.number].push(p.name);
          } else {
            numberMap[p.number] = [p.name];
          }
        });

        Object.entries(numberMap).forEach(([num, names]) => {
          if (names.length > 1) {
            duplicates.push({ number: num, names });
          }
        });

        if (duplicates.length > 0) {
          setDuplicateError(duplicates);
          setStep('duplicates');
        } else {
          generateAssignments(allParticipants);
        }
      };

      // Generate gift assignments using a cycle based on sorted numbers
      const generateAssignments = (allParticipants) => {
        // Sort by number to create deterministic ordering
        const sorted = [...allParticipants].sort((a, b) => a.number - b.number);
        const n = sorted.length;

        // Create a cycle: each person gives to the next in sorted order
        // This ensures everyone gives exactly once and receives exactly once
        // And the giver is always different from who you receive from (for n > 2)
        const results = sorted.map((person, index) => {
          const givesToIndex = (index + 1) % n;
          const receivesFromIndex = (index - 1 + n) % n;

          return {
            person: person.name,
            number: person.number,
            givesTo: sorted[givesToIndex].name,
            givesToNumber: sorted[givesToIndex].number,
            receivesFrom: sorted[receivesFromIndex].name,
            receivesFromNumber: sorted[receivesFromIndex].number,
          };
        });

        // Sort results alphabetically by name for display
        results.sort((a, b) => a.person.localeCompare(b.person));

        setAssignments(results);
        setStep('results');
      };

      // Fix a duplicate - remove the person and let admin re-enter
      const fixDuplicate = (nameToRemove) => {
        const newParticipants = participants.filter(p => p.name !== nameToRemove);
        setParticipants(newParticipants);
        setCurrentName(nameToRemove);
        setCurrentNumber('');
        setDuplicateError(null);
        setStep('members');
      };

      // Start over
      const startOver = () => {
        setStep('count');
        setTotalPeople('');
        setAdminName('');
        setAdminNumber('');
        setParticipants([]);
        setCurrentName('');
        setCurrentNumber('');
        setDuplicateError(null);
        setAssignments(null);
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-red-50 via-white to-green-50 p-6">
          <div className="max-w-2xl mx-auto">
            {/* Header */}
            <div className="text-center mb-8">
              <div className="text-6xl mb-4">ğŸ</div>
              <h1 className="text-3xl font-bold text-gray-800 mb-2">
                Family Gift Exchange
              </h1>
              <p className="text-gray-600">
                {step === 'count' && 'How many people are participating?'}
                {step === 'admin' && 'Enter your information first'}
                {step === 'members' && `Enter family member ${participants.length} of ${totalMembers}`}
                {step === 'duplicates' && 'Duplicate numbers found!'}
                {step === 'results' && 'Gift assignments are ready!'}
              </p>
            </div>

            {/* Step 1: Number of people */}
            {step === 'count' && (
              <div className="space-y-6">
                <div className="bg-white rounded-xl shadow-lg p-6">
                  <h2 className="text-xl font-bold text-gray-800 mb-4">ğŸ‘¥ How many people are exchanging gifts?</h2>
                  <input
                    type="number"
                    min="3"
                    max="20"
                    value={totalPeople}
                    onChange={(e) => setTotalPeople(e.target.value)}
                    placeholder="Enter a number (3-20)"
                    className="w-full px-4 py-3 text-xl text-center border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-400"
                  />
                  <p className="text-sm text-gray-500 mt-2 text-center">Including yourself</p>
                </div>

                <button
                  onClick={proceedToAdmin}
                  disabled={!totalPeople || parseInt(totalPeople) < 3 || parseInt(totalPeople) > 20}
                  className={`w-full py-4 rounded-xl font-bold text-lg transition-all ${
                    totalPeople && parseInt(totalPeople) >= 3 && parseInt(totalPeople) <= 20
                      ? 'bg-gradient-to-r from-red-500 to-green-500 text-white hover:from-red-600 hover:to-green-600 shadow-lg'
                      : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                  }`}
                >
                  Continue â†’
                </button>

                <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                  <h3 className="font-semibold text-amber-800 mb-2">ğŸ“‹ How it works:</h3>
                  <ol className="text-sm text-amber-700 space-y-1 list-decimal list-inside">
                    <li>You enter your name and pick a secret number (1-100)</li>
                    <li>Gather numbers from other family members</li>
                    <li>Enter each person's name and number</li>
                    <li>Generate the gift exchange assignments!</li>
                  </ol>
                </div>
              </div>
            )}

            {/* Step 2: Admin info */}
            {step === 'admin' && (
              <div className="space-y-6">
                <div className="bg-white rounded-xl shadow-lg p-6">
                  <h2 className="text-xl font-bold text-gray-800 mb-4">ğŸ‘¤ Your Information</h2>
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Your Name</label>
                      <input
                        type="text"
                        value={adminName}
                        onChange={(e) => setAdminName(e.target.value)}
                        placeholder="Enter your name"
                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-400"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Your Secret Number (1-100)</label>
                      <input
                        type="number"
                        min="1"
                        max="100"
                        value={adminNumber}
                        onChange={(e) => setAdminNumber(e.target.value)}
                        placeholder="Pick a number 1-100"
                        className="w-full px-4 py-3 text-center border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-400"
                      />
                    </div>
                  </div>
                </div>

                <button
                  onClick={proceedToMembers}
                  disabled={!adminName.trim() || !adminNumber || parseInt(adminNumber) < 1 || parseInt(adminNumber) > 100}
                  className={`w-full py-4 rounded-xl font-bold text-lg transition-all ${
                    adminName.trim() && adminNumber && parseInt(adminNumber) >= 1 && parseInt(adminNumber) <= 100
                      ? 'bg-gradient-to-r from-red-500 to-green-500 text-white hover:from-red-600 hover:to-green-600 shadow-lg'
                      : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                  }`}
                >
                  Continue â†’ Add Family Members
                </button>

                <button
                  onClick={() => setStep('count')}
                  className="w-full py-2 text-gray-500 hover:text-gray-700 text-sm"
                >
                  â† Back
                </button>
              </div>
            )}

            {/* Step 3: Enter other members */}
            {step === 'members' && (
              <div className="space-y-6">
                {/* Progress */}
                <div className="bg-white rounded-xl shadow-lg p-4">
                  <div className="flex justify-between text-sm text-gray-600 mb-2">
                    <span>Progress</span>
                    <span>{participants.length} of {totalMembers} entered</span>
                  </div>
                  <div className="w-full bg-gray-200 rounded-full h-3">
                    <div 
                      className="bg-gradient-to-r from-red-500 to-green-500 h-3 rounded-full transition-all"
                      style={{ width: `${(participants.length / totalMembers) * 100}%` }}
                    />
                  </div>
                </div>

                {/* Already entered */}
                {participants.length > 0 && (
                  <div className="bg-gray-50 rounded-xl p-4 border border-gray-200">
                    <h3 className="font-semibold text-gray-700 mb-2">âœ… Already Entered:</h3>
                    <div className="flex flex-wrap gap-2">
                      {participants.map((p, i) => (
                        <span key={i} className="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm">
                          {p.name} (#{p.number})
                        </span>
                      ))}
                    </div>
                  </div>
                )}

                {/* Current member input */}
                <div className="bg-white rounded-xl shadow-lg p-6">
                  <h2 className="text-xl font-bold text-gray-800 mb-4">
                    ğŸ‘¤ Family Member #{participants.length + 1}
                  </h2>
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Name</label>
                      <input
                        type="text"
                        value={currentName}
                        onChange={(e) => setCurrentName(e.target.value)}
                        placeholder="Enter their name"
                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-400"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Their Number (1-100)</label>
                      <input
                        type="number"
                        min="1"
                        max="100"
                        value={currentNumber}
                        onChange={(e) => setCurrentNumber(e.target.value)}
                        placeholder="Enter their number"
                        className="w-full px-4 py-3 text-center border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-400"
                      />
                    </div>
                  </div>
                </div>

                <button
                  onClick={addMember}
                  disabled={!currentName.trim() || !currentNumber || parseInt(currentNumber) < 1 || parseInt(currentNumber) > 100}
                  className={`w-full py-4 rounded-xl font-bold text-lg transition-all ${
                    currentName.trim() && currentNumber && parseInt(currentNumber) >= 1 && parseInt(currentNumber) <= 100
                      ? 'bg-gradient-to-r from-red-500 to-green-500 text-white hover:from-red-600 hover:to-green-600 shadow-lg'
                      : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                  }`}
                >
                  {participants.length + 1 >= totalMembers ? 'ğŸ„ Generate Gift Exchange ğŸ„' : `Add & Continue â†’`}
                </button>

                <button
                  onClick={() => participants.length === 1 ? setStep('admin') : null}
                  disabled={participants.length > 1}
                  className="w-full py-2 text-gray-500 hover:text-gray-700 text-sm disabled:opacity-50"
                >
                  â† Back
                </button>
              </div>
            )}

            {/* Duplicate Error */}
            {step === 'duplicates' && duplicateError && (
              <div className="space-y-6">
                <div className="bg-red-100 border border-red-300 rounded-xl p-6">
                  <div className="text-center mb-4">
                    <span className="text-5xl">âš ï¸</span>
                    <h2 className="text-2xl font-bold text-red-800 mt-4">Duplicate Numbers Found!</h2>
                  </div>
                  
                  <div className="space-y-3">
                    {duplicateError.map((dup, i) => (
                      <div key={i} className="bg-white rounded-lg p-4 border border-red-200">
                        <p className="font-semibold text-red-700">
                          Number {dup.number} was picked by multiple people:
                        </p>
                        <p className="text-red-600 mt-1">
                          {dup.names.join(' and ')}
                        </p>
                      </div>
                    ))}
                  </div>
                </div>

                <div className="bg-white rounded-xl shadow-lg p-6">
                  <h3 className="font-semibold text-gray-700 mb-3">Choose someone to re-enter with a new number:</h3>
                  <div className="space-y-2">
                    {duplicateError.flatMap(dup => dup.names).filter((name, i, arr) => arr.indexOf(name) === i).map((name, i) => (
                      <button
                        key={i}
                        onClick={() => fixDuplicate(name)}
                        className="w-full py-3 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg font-medium transition-all"
                      >
                        Re-enter number for {name}
                      </button>
                    ))}
                  </div>
                </div>

                <button
                  onClick={startOver}
                  className="w-full py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-medium border border-gray-300"
                >
                  ğŸ”„ Start Over Completely
                </button>
              </div>
            )}

            {/* Results */}
            {step === 'results' && assignments && (
              <div className="space-y-4">
                <div className="bg-green-100 border border-green-300 rounded-xl p-4 text-center">
                  <span className="text-2xl">ğŸ‰</span>
                  <h2 className="text-xl font-bold text-green-800">Gift Assignments Ready!</h2>
                  <p className="text-green-600 text-sm mt-1">Each person gives one gift and receives one gift</p>
                </div>

                {assignments.map((assignment, index) => (
                  <div key={index} className="bg-white rounded-xl shadow-lg p-5 border-2 border-green-200">
                    <div className="flex items-center gap-3 mb-4">
                      <span className="text-3xl">ğŸ…</span>
                      <div>
                        <h3 className="text-xl font-bold text-gray-800">{assignment.person}</h3>
                        <span className="text-sm text-gray-500">Number: {assignment.number}</span>
                      </div>
                    </div>

                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                      <div className="bg-red-50 rounded-lg p-3 border border-red-200">
                        <div className="text-sm text-red-600 font-medium mb-1">ğŸ Gives a gift to:</div>
                        <div className="text-lg font-bold text-red-700">{assignment.givesTo}</div>
                      </div>
                      <div className="bg-green-50 rounded-lg p-3 border border-green-200">
                        <div className="text-sm text-green-600 font-medium mb-1">ğŸ€ Receives a gift from:</div>
                        <div className="text-lg font-bold text-green-700">{assignment.receivesFrom}</div>
                      </div>
                    </div>
                  </div>
                ))}

                {/* Summary */}
                <div className="bg-white rounded-xl shadow-md p-5 border-t-4 border-amber-400">
                  <h3 className="font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <span className="text-2xl">ğŸ“Š</span> Quick Summary
                  </h3>
                  <div className="space-y-2">
                    {assignments.map((a, i) => (
                      <div key={i} className="flex flex-wrap items-center gap-2 text-gray-700">
                        <span className="font-semibold">{a.person}</span>
                        <span className="text-gray-400">â†’</span>
                        <span className="text-red-600">gives to {a.givesTo}</span>
                        <span className="text-gray-400">|</span>
                        <span className="text-green-600">gets from {a.receivesFrom}</span>
                      </div>
                    ))}
                  </div>
                </div>

                <button
                  onClick={startOver}
                  className="w-full py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-bold border border-gray-300"
                >
                  ğŸ”„ Start Over
                </button>
              </div>
            )}

            {/* Footer */}
            <div className="text-center mt-8 text-gray-400 text-sm">
              Happy Holidays! ğŸ„â„ï¸ğŸ
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<GiftGiverApp />);
  </script>
</body>
</html>
